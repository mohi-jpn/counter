<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@0.7.7"></script>

    <link rel="stylesheet" href="css/style.css">
    <title>カウンター</title>
</head>

<body>
    <div class="container">
        <header>
            <h1>カウンター</h1>
        </header>
        計測したタイミングを可視化できます
    </div>

    <div class="container">
        <div>
            <canvas id="myChart"></canvas>
        </div>

        <div class="display-btn">
            <button type="button" id="display" class="btn btn-outline-info" disabled>グラフ表示</button>
        </div>

        <div class="result">
            <p>スコア</p>
            <p id="score">0</p>
        </div>

        <div class="d-grid gap-2">
            <button type="button" id="count" class="btn btn-lg btn-primary">カウント</button>
        </div>

        <div class="reset-btn">
            <button type="button" id="reset" class="btn btn-sm btn-outline-secondary">リセット</button>
        </div>
    </div>

    <hr>

    <div class="container">
        <footer>
            <p>
                &copy; 2021 <a href="https://twitter.com/mohi_jpn" target="_blank">@mohi_jpn</a>
            </p>
        </footer>
    </div>

    <script>
        let history = [];
        let data = [];
        let myChart;

        document.getElementById('count').addEventListener('click', function () {
            const time = Date.now();

            document.getElementById('score').innerHTML++;
            history.push(time);
            document.getElementById('display').disabled = false;
        });

        document.getElementById('reset').addEventListener('click', function () {
            document.getElementById('score').innerHTML = 0;
            history.length = 0;
            data.length = 0;
            myChart.destroy();
            document.getElementById('display').disabled = true;
        });

        document.getElementById('display').addEventListener('click', function () {
            const start_time = history[0];
            data = history.map((time) => {
                return {
                    x: time - start_time,
                    y: 0,
                }
            });
            myChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        backgroundColor: 'rgba(255, 48, 32, 0.45)',
                        borderColor: 'rgba(255, 48, 32, 0.5)',
                        pointRadius: 10,
                        data: data,
                    }],
                },
                options: options,
            });
        });

        let ctx = document.getElementById("myChart");
        let options = {
            title: {
                display: false,
            },
            legend: {
                display: false,
            },
            tooltips: {
                callbacks: {
                    label: (tooltipItem, data) => {
                        return `score: ${tooltipItem.index + 1}, time: ${tooltipItem.label}`;
                    },
                },
            },
            scales: {
                xAxes: [{
                    scaleLabel: {
                        display: true,
                        labelString: '時間(ミリ秒)',
                    },
                    gridLines: {
                        display: true,
                        color: '#ffffff',
                        zeroLineColor: '#ddd',
                        zeroLineWidth: 2,
                    },
                    ticks: {
                        fontColor: '#333',
                        min: 0,
                    },
                }],
                yAxes: [{
                    scaleLabel: {
                        display: false,
                    },
                    gridLines: {
                        color: '#ffffff',
                        zeroLineColor: '#ddd',
                        zeroLineWidth: 2,
                    },
                    ticks: {
                        display: false,
                        fontColor: '#333',
                        min: -5,
                        max: 5,
                    }
                }]
            },
            plugins: {
                zoom: {
                    pan: {
                        enabled: true,
                        mode: 'x'
                    },
                    zoom: {
                        enabled: true,
                        mode: 'x',
                        sensitivity: 3
                    }
                }
            }
        };

    </script>
</body>

</html>